# Dockerfile.slim
# Етап 1: побудова
FROM python:3.9-slim AS build

WORKDIR /app

# Встановлюємо залежності
RUN apt-get update && apt-get install -y \
    build-essential \
    libjpeg-dev \
    && rm -rf /var/lib/apt/lists/*

COPY requirements.txt .
RUN pip install --prefix=/install --no-cache-dir torch torchvision pillow

# Етап 2: мінімальний образ
FROM python:3.9-slim

WORKDIR /app

# Копіюємо модель і скрипт
COPY model.pt .
COPY inference.py .
COPY imagenet_classes.json .

# Копіюємо інстальовані пакети з build етапу
COPY --from=build /install /usr/local

CMD ["python", "inference.py"]
